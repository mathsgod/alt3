!function(e){var r={};function t(n){if(r[n])return r[n].exports;var a=r[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,t),a.l=!0,a.exports}t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var a in e)t.d(n,a,function(r){return e[r]}.bind(null,a));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=0)}([function(e,r){var t=window.Vue;window.$,new t({el:"#app",data:{username:"",password:"",message:"Sign in to start your session",error:!1},created:function(){var e,r,t,n;return regeneratorRuntime.async(function(a){for(;;)switch(a.prev=a.next){case 0:if(!("credentials"in navigator)){a.next=28;break}if(!(e=localStorage.getItem("app.fido2"))){a.next=27;break}return a.next=5,regeneratorRuntime.awrap(this.$gql.query("api",{credentialRequestOptions:{__args:{username:e}}}));case 5:if(!(r=a.sent.data).error){a.next=8;break}return a.abrupt("return");case 8:return t=new WebAuthn.WebAuthn,a.prev=9,a.next=12,regeneratorRuntime.awrap(t.authenticate(r.data.credentialRequestOptions));case 12:n=a.sent,a.next=19;break;case 15:return a.prev=15,a.t0=a.catch(9),console.log(a.t0.message),a.abrupt("return");case 19:return a.next=21,regeneratorRuntime.awrap(this.$gql.query("api",{loginWebAuthn:{__args:{username:e,assertion:JSON.stringify(n)}}}));case 21:if(!(r=a.sent.data).error){a.next=25;break}return alert(r.error.messsage),a.abrupt("return");case 25:return r.data.loginWebAuthn?window.self.location.reload():bootbox.alert("login error"),a.abrupt("return");case 27:this.passwordLogin();case 28:case"end":return a.stop()}},null,this,[[9,15]])},mounted:function(){localStorage.getItem("app.username")&&(this.username=localStorage.getItem("app.username"),this.$refs.remember.checked=!0)},methods:{passwordLogin:function(){var e;return regeneratorRuntime.async(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,regeneratorRuntime.awrap(navigator.credentials.get({password:!0}));case 2:(e=r.sent)&&this.login(e.id,e.password);case 4:case"end":return r.stop()}},null,this)},login:function(e,r){var t,n,a,o=this,s=arguments;return regeneratorRuntime.async(function(i){for(;;)switch(i.prev=i.next){case 0:return t=s.length>2&&void 0!==s[2]?s[2]:"",i.next=3,regeneratorRuntime.awrap(this.$gql.mutation("api",{login:{__args:{username:e,password:r,code:t},username:!0}}));case 3:if(!(n=(n=i.sent).data).error){i.next=9;break}return this.error=!0,"2-step verification"==n.error.message?bootbox.prompt("Please input 2-step verification code",function(t){t&&o.login(e,r,t)}):this.message=n.error.message,i.abrupt("return");case 9:n.data.login&&(this.$refs.remember.checked?localStorage.setItem("app.username",e):localStorage.removeItem("app.username"),""!=(a=window.self.location.hash)?window.self.location=a.substring(2):window.self.location.reload());case 10:case"end":return i.stop()}},null,this)},signIn:function(){return""==this.username?(this.error=!0,void(this.message="Please input username")):""==this.password?(this.error=!0,void(this.message="Please input password")):this.login(this.username,this.password)},forgetPassword:function(){var e=this,r=bootbox.dialog({title:"Forget password",message:document.getElementById("forget-dialog").innerHTML,centerVertical:!0,buttons:{submit:{label:"Submit",className:"btn-success",callback:function(){var t,n;return regeneratorRuntime.async(function(a){for(;;)switch(a.prev=a.next){case 0:if((t=r.find("form")[0]).checkValidity()){a.next=3;break}return a.abrupt("return");case 3:return a.next=5,regeneratorRuntime.awrap(e.$gql.mutation("api",{forgotPassword:{__args:{username:t.username.value,email:t.email.value}}}));case 5:(n=(n=a.sent).data).error?bootbox.alert(n.error.message):bootbox.alert("Password sent to your email if information correct");case 8:case"end":return a.stop()}})}}}})}}})}]);