<div class="row">
    <div class="col-md-3" id="div1">

        <div class="card card-primary card-outline">
            <div class="card-body box-profile">
                <div class="text-center">
                    <img class="profile-user-img img-fluid img-circle" src="User/image" alt="User profile picture">
                </div>

                <h3 class="profile-username text-center">{{app.user.first_name}} {{app.user.last_name}}</h3>

                <p class="text-muted text-center">{{usergroup|join(',',' and ')}}</p>

                <a class="btn btn-primary btn-block" href="User/{{app.user.user_id}}/reset_password">Reset passsword</a>
                <a class="btn btn-primary btn-block" href="User/{{app.user.user_id}}/2step">2 step verfication</a>
                <a class="btn btn-primary btn-block" href="User/{{app.user.user_id}}/2step_whitelist">2 step verfication ip white list</a>
                <button class="btn btn-primary btn-block" @click="createWebAuthn">Web Authentication</button>
            </div>
            <!-- /.card-body -->
        </div>
    </div>

    <div class="col">
        {{user_update_box|raw}}
        {{userlog|raw}}
        {{eventlog|raw}}
    </div>


</div>

<script>
    var vm = new Vue({
        el: "#div1",
        methods: {
            createWebAuthn() {
                this.$gql.query("api", {
                    me: {
                        credentialCreationOptions: true
                    }
                }).then(resp => {
                    var webn = new WebAuthn();
                    webn.register(resp.data.data.me.credentialCreationOptions).then(resp => {
                        this.webAuthnRegister(resp);
                    }).catch(resp => {
                        alert(resp.message);
                    });
                });
            }, webAuthnRegister(info) {
                this.$gql.mutation("api", {
                    me: {
                        registrationWebAuthn: {
                            __args: {
                                attestion: JSON.stringify(info)
                            }
                        }
                    }
                }).then(resp => {
                    this.$gql.query("api", {
                        me: {
                            username: true
                        }
                    }).then(resp => {
                        localStorage.setItem("app.fido2", resp.data.data.me.username);
                        alert("Register completed");
                    });
                });
            }
        }
    });

</script>